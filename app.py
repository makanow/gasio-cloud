# [ get_pdf_report_html é–¢æ•°ã‚’ä»¥ä¸‹ã«å·®ã—æ›¿ãˆ ]

def get_pdf_report_html(summ_df, sel_plan_name):
    # èƒŒæ™¯ã‚’èµ¤ã‹ã‚‰Gasio Blueã¸å¤‰æ›´ã€æ–‡è¨€ã‚’ã€Œç”Ÿæˆã€ã«ä¿®æ­£
    # ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ã‚ˆã‚Šç¾ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ãŸHTML
    formatted_table = summ_df.style.format({
        "å£²ä¸Šç·é¡": "Â¥{:,.0f}",
        "å·®é¡": "Â¥{:,.0f}",
        "å¢—æ¸›ç‡": "{:+.2f}%"
    }).to_html(index=False)

    html_content = f"""
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <style>
            body {{ font-family: "Helvetica Neue", Arial, sans-serif; padding: 50px; color: #2c3e50; line-height: 1.6; }}
            .report-header {{ border-bottom: 2px solid #3498db; padding-bottom: 20px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: flex-end; }}
            .report-title {{ font-size: 28px; font-weight: bold; color: #2c3e50; margin: 0; }}
            .date {{ color: #7f8c8d; font-size: 14px; }}
            .section-title {{ font-size: 18px; font-weight: bold; margin-top: 40px; margin-bottom: 15px; border-left: 5px solid #3498db; padding-left: 10px; }}
            table {{ width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }}
            th {{ background-color: #f8f9fa; color: #34495e; padding: 12px; border: 1px solid #dee2e6; text-align: center; }}
            td {{ padding: 12px; border: 1px solid #dee2e6; text-align: right; }}
            tr:nth-child(even) {{ background-color: #fcfcfc; }}
            .best-plan {{ color: #e74c3c; font-weight: bold; }}
            .footer {{ margin-top: 50px; font-size: 12px; color: #95a5a6; text-align: center; border-top: 1px solid #eee; padding-top: 20px; }}
            @media print {{ .no-print {{ display: none; }} body {{ padding: 20px; }} }}
        </style>
    </head>
    <body>
        <div class="report-header">
            <h1 class="report-title">ã‚¬ã‚¹æ–™é‡‘æ”¹å®šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å ±å‘Šæ›¸</h1>
            <span class="date">ä½œæˆæ—¥: {datetime.datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')}</span>
        </div>
        
        <div class="section-title">1. åæ”¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœä¸€è¦§</div>
        <p>ç¾è¡Œæ–™é‡‘ä½“ç³»ã¨è¨­è¨ˆã—ãŸæ–°ãƒ—ãƒ©ãƒ³ã¨ã®å£²ä¸Šæ¯”è¼ƒï¼ˆå¹´æ›ç®—ï¼‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p>
        {formatted_table}
        
        <div class="section-title">2. åˆ†ææ¦‚è¦</div>
        <p>æœ¬å ±å‘Šæ›¸ã¯ã€Œ{sel_plan_name}ã€ã‚’ä¸»å¯¾è±¡ã¨ã—ãŸã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚</p>
        
        <div class="footer">
            Gasio Cloud Edition - Generated by Simulation Engine
        </div>
        
        <div class="no-print" style="margin-top: 30px; text-align: center;">
            <button onclick="window.print()" style="padding: 10px 20px; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                ğŸ–¨ï¸ PDFã¨ã—ã¦ä¿å­˜ / å°åˆ·
            </button>
        </div>
    </body>
    </html>
    """
    
    # ç¢ºå®Ÿã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ãŸã‚ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å‡¦ç†
    try:
        b64 = base64.b64encode(html_content.encode('utf-8')).decode('utf-8')
        button_style = "width:100%; height:40px; background-color:#3498db; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;"
        return f'<a href="data:text/html;charset=utf-8;base64,{b64}" target="_blank" style="text-decoration:none;"><button style="{button_style}">ğŸ“„ å ±å‘Šç”¨ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ</button></a>'
    except Exception as e:
        return f"ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚¨ãƒ©ãƒ¼: {str(e)}"

# [ Tab 2 ã®å‘¼ã³å‡ºã—éƒ¨åˆ†ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ã«èª¿æ•´ ]
# st.markdown(get_pdf_report_html(pd.DataFrame(summ_list), sel_p), unsafe_allow_html=True)
